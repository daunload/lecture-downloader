name: Build Electron App

on:
    push:
        tags:
            - 'v*'

jobs:
    release:
        runs-on: ${{ matrix.os }}

        strategy:
            matrix:
                os: [windows-latest, macos-latest]

        permissions:
            contents: write

        steps:
            - name: Check out Git repository
              uses: actions/checkout@v3
              with:
                  fetch-depth: 0 # íƒœê·¸ ì •ë³´ í¬í•¨

            - name: Install Node.js, NPM and Yarn
              uses: actions/setup-node@v3
              with:
                  node-version: 22.14.0

            - name: Check Node.js version
              run: node -v #

            - name: Install dependencies using npm ci
              run: npm ci # npm ci ëª…ë ¹ì–´ ì‹¤í–‰

            - name: Build/release Electron app (macOS)
              if: matrix.os == 'macos-latest'
              run: npm run dist:mac
              env:
                  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              timeout-minutes: 10

            - name: Build/release Electron app (Windows)
              if: matrix.os == 'windows-latest'
              run: |
                  # PowerShell 5.xê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì–´ ìˆì„ ìˆ˜ ìˆì§€ë§Œ, ëª…ì‹œì ìœ¼ë¡œ ì‹¤í–‰
                  $PSVersionTable.PSVersion
                  powershell -Version 5 -Command "npm run dist:win"
                  Compress-Archive -Path dist\win-unpacked\* -DestinationPath dist\win-unpacked.zip
              env:
                  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              continue-on-error: true
              timeout-minutes: 10

            - name: Debug build output
              run: ls -R dist/

            - name: Create GitHub Release
              uses: softprops/action-gh-release@v2
              with:
                  tag_name: ${{ github.ref_name }}
                  files: |
                      dist/*.dmg
                      dist/*.exe
                      dist/*.zip
                  body: 'ğŸš€ ìƒˆë¡œìš´ ë²„ì „ ë¹Œë“œ'
              env:
                  GITHUB_TOKEN: ${{ secrets.GH_PAT }}
              continue-on-error: true
